dXNlcm5hbWUtYXBpbUNrKSRlP2syfilVS3ZNflc=


<choose>
            <when condition="@(context.Request.Headers.GetValueOrDefault("Authorization").AsBasic().UserId!="{{username}}" || context.Request.Headers.GetValueOrDefault("Authorization").AsBasic().Password!="{{password}}")">
                <return-response>
                    <set-status code="401" reason="Unauthorized" />
                </return-response>
            </when>
        </choose>
        <set-header name="Authorization" exists-action="delete" />






OCP_APIM_SUBSCRIPTION_VALUE = "47948f31d8ca4e2f804e9f1561ae2164"
URL = "https://api-mg-rg-dev-az.azure-api.net/fas-dev-az/HttpTriggerSendInvoiceDataToEventHub""


headers = {
    'Host': 'noreur-dev-dataeng-apim.azure-api.net',
    'Ocp-Apim-Subscription-Key': OCP_APIM_SUBSCRIPTION_VALUE,
    'Ocp-Apim-Trace': 'true'
}


def send_invoice_to_rest_api(invoices):
    """[summary]
    Args:
        number_of_tweet_messages ([type]): [description]
    """
    tweets_stream_sample = pd.read_json(
        "./data/preprocessed/merged/merged_tweets_image_metadata_stream.json",
        orient="records")

    if invoices < 1000:  # tweets_stream_sample.shape[0]:
        tweets_stream_sample = tweets_stream_sample.iloc[:invoices, ]
        for i in tweets_stream_sample.index:

            print(tweets_stream_sample.iloc[i])

            records_for_export = tweets_stream_sample.iloc[i].to_json()
            request = requests.post(
                url=URL, data=records_for_export, headers=headers)

            if request.status_code == 200:
                print(f"Request number {i} is succesfullly posted.")
                print(records_for_export)
                time.sleep(10)
                print(request.content)
                print(request.status_code)

            else:
                print(
                    f"Request number {i} NOT succeded! Status code {request.status_code}")
    else:
        print(
            f"Maximum number of tweets is {tweets_stream_sample.shape[0]}, and you have chosen: {invoices}. Please choose a smaller number!")


if __name__ == '__main__':
    fire.Fire()